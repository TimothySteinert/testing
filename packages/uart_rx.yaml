uart:
  id: uart_bus
  tx_pin: 22
  rx_pin: 21
  baud_rate: 9600
  debug:
    direction: RX
    dummy_receiver: true
    after:
      bytes: 16   # process full packet
    sequence:
      - lambda: |-
          if (bytes.size() != 16) return;

          uint8_t id_byte = bytes[0];
          uint8_t crc_calc = 0x00;
          for (int i = 0; i < 15; i++) {
            crc_calc ^= bytes[i];
          }
          uint8_t crc_recv = bytes[15];

          if (id_byte != 0xA0) {
            ESP_LOGW("uart_rx", "Ignored packet: wrong ID 0x%02X", id_byte);
            return;
          }

          if (crc_recv != crc_calc) {
            ESP_LOGW("uart_rx", "CRC mismatch: got 0x%02X expected 0x%02X", crc_recv, crc_calc);
            return;
          }

          ESP_LOGI("uart_rx", "Valid 16-byte message received:");
          char buf[100];
          int idx = 0;
          for (size_t i = 0; i < bytes.size(); i++) {
            idx += snprintf(buf + idx, sizeof(buf) - idx, "0x%02X ", bytes[i]);
          }
          ESP_LOGI("uart_rx", "%s", buf);
