uart:
  id: uart_bus
  tx_pin: 22
  rx_pin: 21
  baud_rate: 9600
  debug:
    direction: RX
    dummy_receiver: true
    after:
      bytes: 16   # process full packet
    sequence:
      - lambda: |-
          if (bytes.size() != 16) return;

          uint8_t id_byte = bytes[0];
          uint8_t crc_calc = 0x00;
          for (int i = 0; i < 15; i++) {
            crc_calc ^= bytes[i];
          }
          uint8_t crc_recv = bytes[15];

          if (id_byte != 0xA0) {
            ESP_LOGW("uart_rx", "Ignored packet: wrong ID 0x%02X", id_byte);
            return;
          }

          if (crc_recv != crc_calc) {
            ESP_LOGW("uart_rx", "CRC mismatch: got 0x%02X expected 0x%02X", crc_recv, crc_calc);
            return;
          }

          // Extract prefix (bytes 1–3)
          std::string prefix;
          for (int i = 1; i <= 3; i++) {
            if (bytes[i] != 0x00) prefix.push_back((char)bytes[i]);
          }

          // Extract arm mode (byte 4)
          uint8_t arm_mode = bytes[4];

          // Extract PIN (bytes 5–14)
          std::string pin;
          for (int i = 5; i <= 14; i++) {
            if (bytes[i] != 0x00) pin.push_back((char)bytes[i]);
          }

          // Print results
          ESP_LOGI("uart_rx", "Valid message received:");
          ESP_LOGI("uart_rx", "  Prefix   : %s", prefix.c_str());
          ESP_LOGI("uart_rx", "  Arm Mode : %d", arm_mode);
          ESP_LOGI("uart_rx", "  PIN      : %s", pin.c_str());
